---
layout: default
---
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

<div id="app">
    {% raw %}
    <div>28 days ago:
        <a target="_blank" :href="buildDriveURL(twentyEightDays)">{{ toHumanReadableString(twentyEightDays) }}</a>
        <a target="_blank" :href="buildDropboxURL(twentyEightDays)">D</a>
    </div>
    <div>25 weeks ago:
        <a target="_blank" :href="buildDriveURL(twentyFiveWeeks)">{{ toHumanReadableString(twentyFiveWeeks) }}</a>
        <a target="_blank" :href="buildDropboxURL(twentyFiveWeeks)">D</a>
    </div>
    <div>6 months ago:
        <a target="_blank" :href="buildDriveURL(sixMonths)">{{ toHumanReadableString(sixMonths) }}</a>
        <a target="_blank" :href="buildDropboxURL(sixMonths)">D</a>
    </div>
    <div>50 weeks ago:
        <a target="_blank" :href="buildDriveURL(fiftyWeeks)">{{ toHumanReadableString(fiftyWeeks) }}</a>
        <a target="_blank" :href="buildDropboxURL(fiftyWeeks)">D</a>
    </div>
    <div v-for="date in yearsSince2021">
        {{ date.label }}:
        <a target="_blank" :href="buildDriveURL(date.date)">{{ toHumanReadableString(date.date) }}</a>
        <a target="_blank" :href="buildDropboxURL(date.date)">D</a>
    </div>
    <div v-for="date in diced">
        ðŸŽ²:
        <a target="_blank" :href="buildDriveURL(date)">{{ toHumanReadableString(date) }}</a>
        <a target="_blank" :href="buildDropboxURL(date)">D</a>
    </div>
    <div>
        <button @click="rollDice">ðŸŽ²</button>
    </div>
    <div>
        User Number: <input v-model="userNumber" />
    </div>
    {% endraw %}
</div>

<script type="text/javascript">
const NowMixin = {
    data() {
        return {
            nowForceRefresh: 0,
        };
    },
    mounted() {
        this.nowInterval = setInterval(
            () => this.nowForceRefresh = !this.nowForceRefresh,
            1000
        );
    },
    unmounted() {
        clearInterval(this.nowInterval);
    },
    methods: {
        now(...args) {
            this.nowForceRefresh;
            return new Date(...args);
        },
    },
};

new Vue({
    el: '#app',
    mixins: [NowMixin],
    data() {
        return {
            userNumber: localStorage.getItem('calendarUserNumber') ?? '0',
            diced: [],
        };
    },
    watch: {
        userNumber() {
            localStorage.setItem('calendarUserNumber', this.userNumber);
        },
    },
    computed: {
        twentyEightDays() {
            const d = this.now();
            d.setDate(d.getDate() - 28);
            return d;
        },
        twentyFiveWeeks() {
            const d = this.now();
            d.setDate(d.getDate() - (7 * 25));
            return d;
        },
        sixMonths() {
            const d = this.now();
            d.setMonth(d.getMonth() - 6);
            return d;
        },
        fiftyWeeks() {
            const d = this.now();
            d.setDate(d.getDate() - (7 * 50));
            return d;
        },
        yearsSince2021() {
            const begin2021 = this.now('2021-01-01');
            const dates = [];
            let d = this.now();
            let ago = 0;
            while (d > begin2021) {
                d.setMonth(d.getMonth() - 12);
                ago++
                dates.push({
                    label: `${ago} years ago`,
                    date: new Date(d),
                });
            }
            return dates;
        },
    },
    methods: {
        buildDriveURL(date) {
            const searchBase = `https://drive.google.com/drive/u/${this.userNumber}/search?q=`;
            const dateString = date.toLocaleDateString(
                'en-US',
                {month: 'long', day: 'numeric', year: 'numeric'}
            );
            return searchBase + encodeURIComponent(dateString);
        },
        buildDropboxURL(date) {
            const searchBase = 'https://www.dropbox.com/search/personal?path=%2F&query=';
            const today = new Date(date);
            today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const after = today.toISOString().substr(0, 10);
            const before = tomorrow.toISOString().substr(0, 10);
            return searchBase + encodeURIComponent(`after:${after} before:${before}`);
        },
        toHumanReadableString(date) {
            return date.toLocaleDateString(
                'en-US',
                {weekday: 'long', month: 'long', day: 'numeric', year: 'numeric'}
            );
        },
        rollDice() {
            const date = new Date();
            date.setUTCDate(date.getUTCDate() - parseInt(Math.random() * 1000));
            this.diced.push(date);
        },
    },
});
</script>
