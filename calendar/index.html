---
layout: default
---
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

<div id="app">
    {% raw %}
    <div>28 days ago:
        <a :href="searchBase + encodeURIComponent(shortString(twentyEightDays))">{{ longString(twentyEightDays) }}</a>
    </div>
    <div>25 weeks ago:
        <a :href="searchBase + encodeURIComponent(shortString(twentyFiveWeeks))">{{ longString(twentyFiveWeeks) }}</a>
    </div>
    <div>6 months ago:
        <a :href="searchBase + encodeURIComponent(shortString(sixMonths))">{{ longString(sixMonths) }}</a>
    </div>
    <div>50 weeks ago:
        <a :href="searchBase + encodeURIComponent(shortString(fiftyWeeks))">{{ longString(fiftyWeeks) }}</a>
    </div>
    <div v-for="date in yearsSince2021">
        {{ date.label }}:
        <a :href="searchBase + encodeURIComponent(shortString(date.date))">{{ longString(date.date) }}</a>
    </div>
    <div v-for="date in diced">
        ðŸŽ²:
        <a :href="searchBase + encodeURIComponent(shortString(date.date))">{{ longString(date.date) }}</a>
    </div>
    <div>
        <button @click="rollDice">ðŸŽ²</button>
    </div>
    <div>
        User Number: <input v-model="userNumber" />
    </div>
    {% endraw %}
</div>

<script type="text/javascript">
const NowMixin = {
    data() {
        return {
            nowForceRefresh: 0,
        };
    },
    mounted() {
        this.nowInterval = setInterval(
            () => this.nowForceRefresh = !this.nowForceRefresh,
            1000
        );
    },
    unmounted() {
        clearInterval(this.nowInterval);
    },
    methods: {
        now(...args) {
            this.nowForceRefresh;
            return new Date(...args);
        },
    },
};

new Vue({
    el: '#app',
    mixins: [NowMixin],
    data() {
        return {
            userNumber: localStorage.getItem('calendarUserNumber') ?? '0',
            diced: [],
        };
    },
    watch: {
        userNumber() {
            localStorage.setItem('calendarUserNumber', this.userNumber);
        },
    },
    computed: {
        twentyEightDays() {
            const d = this.now();
            d.setDate(d.getDate() - 28);
            return d;
        },
        twentyFiveWeeks() {
            const d = this.now();
            d.setDate(d.getDate() - (7 * 25));
            return d;
        },
        sixMonths() {
            const d = this.now();
            d.setMonth(d.getMonth() - 6);
            return d;
        },
        fiftyWeeks() {
            const d = this.now();
            d.setDate(d.getDate() - (7 * 50));
            return d;
        },
        yearsSince2021() {
            const begin2021 = this.now('2021-01-01');
            const dates = [];
            let d = this.now();
            let ago = 0;
            while (d > begin2021) {
                d.setMonth(d.getMonth() - 12);
                ago++
                dates.push({
                    label: `${ago} years ago`,
                    date: new Date(d),
                });
            }
            return dates;
        },
        searchBase() {
            return `https://drive.google.com/drive/u/${this.userNumber}/search?q=`;
        },
    },
    methods: {
        longString(date) {
            return date.toLocaleDateString(
                'en-US',
                {weekday: 'long', month: 'long', day: 'numeric', year: 'numeric'}
            );
        },
        shortString(date) {
            return date.toLocaleDateString(
                'en-US',
                {month: 'long', day: 'numeric', year: 'numeric'}
            );
        },
        rollDice() {
            const date = new Date();
            date.setUTCDate(date.getUTCDate() - parseInt(Math.random() * 1000));
            this.diced.push({
                label: '',
                date,
            });
        },
    },
});
</script>
